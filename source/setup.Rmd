# Setting up your computer {#move-to-your-own-machine}

```{r setup-machine-setup, include = FALSE}
library(tidyverse)
library(cowplot)
library(knitr)
library(magick)

knitr::opts_chunk$set(fig.align = "center")

options(knitr.table.format = ifelse(knitr::is_latex_output(), "latex", "html"))
```

## Overview

In this chapter, you'll learn how to set up the software 
needed to follow along with this book on your own computer.
Given that installation instructions can vary
widely based on the computer setup, we have created instructions for multiple
operating systems. In particular, the installation instructions below have
been verified to work on a computer that:

- runs one of the following operating systems: 
  - Ubuntu 22.04
  - macOS Big Sur (version 11.4.x or 11.5.x)
  - Windows 10 Home
- uses a 64-bit CPU,
- has a connection to the internet,
- uses English as the default language.


## Chapter learning objectives

By the end of the chapter, readers will be able to do the following:

- Download the worksheets that accompany this book.
- Install the Docker virtualization engine.
- Edit and run the worksheets using JupyterLab running inside a Docker container.
- Install Git, JupyterLab Desktop, and R packages.
- Edit and run the worksheets using JupyterLab Desktop.

## Obtaining the worksheets for this book

The worksheets containing exercises for this book 
are online at [https://worksheets.datasciencebook.ca](https://worksheets.datasciencebook.ca).
The worksheets can be launched directly from that page using the Binder links in the rightmost
column of the table. This is the easiest way to access the worksheets, but note that you will not 
be able to save your work and return to it again later.
In order to save your progress, you will need to download the worksheets to your own computer and 
work on them locally. You can download the worksheets as a compressed zip file 
using [the link at the top of the page](https://github.com/UBC-DSCI/data-science-a-first-intro-worksheets/archive/refs/heads/main.zip).
Once you unzip the downloaded file, you will have a folder containing all of the Jupyter notebook worksheets
accompanying this book. See Chapter \@ref(getting-started-with-jupyter) for
instructions on working with Jupyter notebooks.

## Working with Docker

Once you have downloaded the worksheets, you will next need to install and run
the software required to work on Jupyter notebooks on your own computer. Doing
this setup manually can be quite tricky, as it involves quite a few different
software packages, not to mention getting the right versions of
everything&mdash;the worksheets and autograder tests may not work unless all the versions are
exactly right! To keep things simple, we instead recommend that you install
[Docker](https://docker.com). Docker lets you run your Jupyter notebooks inside
a pre-built *virtual machine* that comes with precisely the right versions of 
all software packages needed run the worksheets that come with this book.
\index{Docker}

### Ubuntu

To install Docker on Ubuntu, open the terminal and enter the following five commands.
```
sudo apt update
sudo apt install ca-certificates curl gnupg
curl -fsSL https://get.docker.com -o get-docker.sh
sudo chmod u+x get-docker.sh
sudo sh get-docker.sh
```
Then in the terminal, navigate to the directory where you want to run JupyterLab, and run
the following command.
```
docker run --rm -v $(pwd):/home/jovyan/work -p 8888:8888 ubcdsci/r-dsci-100:20230724142640d8f06f jupyter lab
```
The terminal will then print some text as the Docker container starts. Once the text stops scrolling, find the 
URL in your terminal that starts with `http://127.0.0.1:8888` (highlighted by the red box Figure \@ref(fig:ubuntu-docker-terminal)), and paste it into your browser to start JupyterLab.

```{r ubuntu-docker-terminal, echo = FALSE, fig.cap = "The terminal text after running the Docker container in Ubuntu. The red box indicates the URL that you should paste into your browser to open JupyterLab.", fig.retina = 2, out.width="100%"}
image_read("img/setup/ubuntu-docker.png") |> 
  image_crop("3632x2000")
```

More information on installing and running Docker on Ubuntu, as well as troubleshooting tips, can be found
[in the online Docker documentation](https://docs.docker.com/engine/install/ubuntu/).

### MacOS

To install Docker on MacOS, visit [the online Docker
documentation](https://docs.docker.com/desktop/install/mac-install/), and
download the `Docker.dmg` installation file that is appropriate for your
computer (you need to know whether your computer has an Intel processor an
Apple processor). Double-click the file to open the installer, then drag
the Docker icon to the Applications folder.  Double-click Docker.app in the
Applications folder to start Docker. In the installation window, use the
recommended settings.

Once Docker is installed and running, follow the instructions below in the Windows section
for finding and running the virtual machine we have made available for this book.
More information on installing and running
Docker on MacOS, as well as troubleshooting tips, can be found [in the online
Docker documentation](https://docs.docker.com/desktop/install/mac-install/).

### Windows

To install Docker on Windows, visit [the online Docker documentation](https://docs.docker.com/desktop/install/windows-install/),
and download the `Docker Desktop Installer.exe` file. Double-click the file to open the installer
and follow the instructions on the installation wizard, choosing **WSL-2** instead of **Hyper-V** when prompted.

Occasionally, when you first run Docker on Windows, you will encounter an error message. Some common errors you may see:

- If you need to update WSL, you can enter `cmd.exe` in the Start menu to run the command line. Type `wsl --update` to update WSL.
- If the admin account on your computer is different to your user account, you must add the user to the "docker-users" group. 
  Run Computer Management as an administrator and navigate to `Local Users` and `Groups -> Groups -> docker-users`. Right-click to 
  add the user to the group. Log out and log back in for the changes to take effect.
- If you need to enable virtualization, you will need to edit your BIOS. Restart your computer, and enter the BIOS using the hotkey
  (usually Delete, Esc, and/or one of the F# keys). Look for an "Advanced" menu, and under your CPU settings, set the "Virtualization" option
  to "enabled". Then save the changes and reboot your machine. If you are not familiar with BIOS editing, you may want to find an expert 
  to help you with this, as editing the BIOS can be dangerous. Detailed instructions for doing this are beyond the scope of this book. 
More information on installing and running
Docker on Windows, as well as troubleshooting tips, can be found [in the online
Docker documentation](https://docs.docker.com/desktop/install/windows-install/).


Once Docker is running (in either Windows or MacOS), you need to download and run the virtual machine that we have made available
for the worksheets. In the search bar, enter `ubcdsci/r-dsci-100`, as this is the name of the virtual machine image. You will be presented
with a few options (Figure \@ref(fig:docker-desktop-search)). In the "Tag" drop down menu, click the tag `20230724142640d8f06f` to select the 
correct version of the image. Then click the "Pull" button to download the image.

```{r docker-desktop-search, echo = FALSE, fig.cap = "The Docker Desktop search window. Make sure to click the Tag drop down menu and find the right version of the image before clicking the Pull button to download it.", fig.retina = 2, out.width="100%"}
image_read("img/setup/docker-1.png") |> 
  image_crop("3632x2000")
```

Once the image is done downloading, click the "Images" button on the left side of the Docker Desktop window (Figure \@ref(fig:docker-desktop-images)). You
will see the recently downloaded image listed there under the "Local" tab.

```{r docker-desktop-images, echo = FALSE, fig.cap = "The Docker Desktop images tab.", fig.retina = 2, out.width="100%"}
image_read("img/setup/docker-2.png") |> 
  image_crop("3632x2000")
```

To run the virtual machine, click the play button beside the image. This will open the run configuration menu (Figure \@ref(fig:docker-desktop-runconfig)).
In the "Host port" textbox, enter `8888`. In the "Volumes" section, click the "Host path" box and navigate to the folder where your Jupyter worksheets
are stored. In the "Container path" text box, enter `/home/jovyan/work`. Then click the "Run" button to start the container.

```{r docker-desktop-runconfig, echo = FALSE, fig.cap = "The Docker Desktop container run configuration menu.", fig.retina = 2, out.width="100%"}
image_read("img/setup/docker-3.png") |> 
  image_crop("3632x2000")
```

After clicking the "Run" button, you will see a terminal. The terminal will then print 
some text as the Docker container starts. Once the text stops scrolling, find the 
URL in the terminal that starts 
with `http://127.0.0.1:8888` (highlighted by the red box in Figure \@ref(fig:ubuntu-docker-terminal)), and paste it 
into your browser to start JupyterLab.

```{r docker-desktop-url, echo = FALSE, fig.cap = "The terminal text after running the Docker container in Ubuntu. The red box indicates the URL that you should paste into your browser to open JupyterLab.", fig.retina = 2, out.width="100%"}
image_read("img/setup/docker-4.png") |> 
  image_crop("3632x2000")
```

## Working with JupyterLab Desktop

You can also run the worksheets accompanying this book on your computer
using [JupyterLab Desktop](https://github.com/jupyterlab/jupyterlab-desktop).
The advantage of JupyterLab Desktop over Docker is that it can be easier to install;
JupyterLab Desktop is just like any other software you install on your computer,
while Docker is a bit special and can sometimes run into some fairly technical issues that require expert
troubleshooting. On the other hand, if you are able to successfully install Docker, it essentially
*guarantees* that the worksheets will work exactly as intended. With JupyterLab Desktop, on the other
hand, you may not end up with the right versions of all the R packages that are installed, and the 
worksheets may run into bugs.

In this section, we will cover how to install Git (for version control, as discussed in Chapter \@ref(Getting-started-with-version-control)),
JupyterLab Desktop, the JupyterLab Git extension, and all of the R packages needed to run the code in this book.
\index{git!installation}\index{JupyterLab Desktop}

### Ubuntu

First, we will install Git for version control. 
Open the terminal and type the following commands:
```
sudo apt update
sudo apt install git
```
Next, visit the ["Installation" section of the JupyterLab Desktop homepage](https://github.com/jupyterlab/jupyterlab-desktop#installation).
Download the `JupyterLab-Setup-Debian.deb` installer file for Ubuntu/Debian.
Open a terminal, navigate to where the installer file was downloaded, and run the command
```
sudo dpkg -i JupyterLab-Setup-Debian.deb
```
Run JupyterLab Desktop using the command
```
jlab
```
Next, in the JupyterLab Desktop graphical interface that appears (Figure \@ref(fig:setup-jlab-gui)), 
you will see text at the bottom saying "Python environment not found". Click "Install using the bundled installer"
to set up the environment.

```{r setup-jlab-gui, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "The JupyterLab Desktop graphical user interface.", out.width="85%", fig.align = "center", fig.retina = 2}
knitr::include_graphics("img/setup/jlab-1.png")
```

Next, we need to add the JupyterLab Git extension (so that
we can use version control directly from within JupyterLab Desktop),
the IRkernel (to enable the R programming language),
and various R software packages. Click "New session..." in the JupyterLab Desktop
user interface, then scroll to the bottom, and click "Terminal" under the "Other" heading (Figure \@ref(fig:setup-jlab-gui-2)).
```{r setup-jlab-gui-2, echo = FALSE, message = FALSE, warning = FALSE, fig.cap = "A JupyterLab Desktop session, showing the Terminal option at the bottom.", out.width="85%", fig.align = "center", fig.retina = 2}
knitr::include_graphics("img/setup/jlab-2.png")
```
In this terminal, run the following commands:
```
pip install --upgrade jupyterlab-git
conda env update --file https://raw.githubusercontent.com/UBC-DSCI/data-science-a-first-intro-worksheets/main/environment.yml
```
The second command installs the specific R and package versions specified in
the `environment.yml` file found in 
[the worksheets repository](https://worksheets.datasciencebook.ca).
We will always keep the versions in the `environment.yml` file updated
so that they are compatible with the exercise worksheets that accompany the book.

> You can also install the *latest* version of R 
> and the R packages used in this book by instead typing the commands shown below 
> **Be careful though:** this may install package versions that are
> incompatible with the worksheets that accompany the book; the automated
> exercise feedback might tell you your answers are not correct even though
> they are!
> 
> ```
> pip install --upgrade jupyterlab-git
> conda install -c conda-forge r-base r-cowplot r-ggally r-gridextra 
> conda install -c conda-forge r-kknn r-rpostgres r-rsqlite r-scales r-testthat 
> conda install -c conda-forge r-tidymodels r-tidyverse unixodbc
> ```

Once all of the software installation is complete, it is a good idea to restart 
JupyterLab Desktop entirely before you proceed to doing your data analysis.
This will ensure all the software and settings you put in place are 
correctly set up and ready for use.

### Windows

First, we will install Git for version control. 
Go to [the Git download page](https://git-scm.com/download/win) and 
download the Windows version of Git. Once the download has finished, run the installer and accept 
the default configuration for all pages.
Next, visit the ["Installation" section of the JupyterLab Desktop homepage](https://github.com/jupyterlab/jupyterlab-desktop#installation).
Download the `JupyterLab-Setup-Windows.exe` installer file for Windows.
Double-click the installer to run it, use the default settings.
Run JupyterLab Desktop by clicking the icon on your desktop.

From this point onward, with JupyterLab Desktop running,
follow the instructions in the Ubuntu section on how to set up the
environment, install the JupyterLab Git extension, and install
the various R software packages needed for the worksheets.


### MacOS

First, we will install Git for version control. 
Open the terminal ([how-to video](https://youtu.be/5AJbWEWwnbY)) 
and type the following command:

```
xcode-select --install
```
Next, visit the ["Installation" section of the JupyterLab Desktop homepage](https://github.com/jupyterlab/jupyterlab-desktop#installation).
Download the `JupyterLab-Setup-MacOS-x64.dmg` or `JupyterLab-Setup-MacOS-arm64.dmg` installer file 
(you need to know whether your computer has an Intel processor an
Apple processor). Double-click the file to open the installer, then drag
the JupyterLab Desktop icon to the Applications folder.  Double-click 
the icon in the
Applications folder to start JupyterLab Desktop.

From this point onward, with JupyterLab Desktop running,
follow the instructions in the Ubuntu section on how to set up the
environment, install the JupyterLab Git extension, and install
the various R software packages needed for the worksheets.
