<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Cleaning and wrangling data | Introduction to Data Science</title>
  <meta name="description" content="This is an open source textbook for teaching introductory data science." />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Cleaning and wrangling data | Introduction to Data Science" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is an open source textbook for teaching introductory data science." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Cleaning and wrangling data | Introduction to Data Science" />
  
  <meta name="twitter:description" content="This is an open source textbook for teaching introductory data science." />
  

<meta name="author" content="Tiffany-Anne Timbers" />
<meta name="author" content="Trevor Campbell" />
<meta name="author" content="Melissa Lee" />


<meta name="date" content="2020-12-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="reading.html"/>
<link rel="next" href="viz.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Introduction to Data Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> R, Jupyter, and the tidyverse</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#chapter-learning-objectives"><i class="fa fa-check"></i><b>1.1</b> Chapter learning objectives</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#jupyter-notebooks"><i class="fa fa-check"></i><b>1.2</b> Jupyter notebooks</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#loading-a-spreadsheet-like-dataset"><i class="fa fa-check"></i><b>1.3</b> Loading a spreadsheet-like dataset</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#assigning-value-to-a-data-frame"><i class="fa fa-check"></i><b>1.4</b> Assigning value to a data frame</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#creating-subsets-of-data-frames-with-select-filter"><i class="fa fa-check"></i><b>1.5</b> Creating subsets of data frames with <code>select</code> &amp; <code>filter</code></a><ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#using-select-to-extract-multiple-columns"><i class="fa fa-check"></i><b>1.5.1</b> Using <code>select</code> to extract multiple columns</a></li>
<li class="chapter" data-level="1.5.2" data-path="index.html"><a href="index.html#using-select-to-extract-a-range-of-columns"><i class="fa fa-check"></i><b>1.5.2</b> Using <code>select</code> to extract a range of columns</a></li>
<li class="chapter" data-level="1.5.3" data-path="index.html"><a href="index.html#using-filter-to-extract-a-single-row"><i class="fa fa-check"></i><b>1.5.3</b> Using <code>filter</code> to extract a single row</a></li>
<li class="chapter" data-level="1.5.4" data-path="index.html"><a href="index.html#using-filter-to-extract-rows-with-values-above-a-threshold"><i class="fa fa-check"></i><b>1.5.4</b> Using <code>filter</code> to extract rows with values above a threshold</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#exploring-data-with-visualizations"><i class="fa fa-check"></i><b>1.6</b> Exploring data with visualizations</a><ul>
<li class="chapter" data-level="1.6.1" data-path="index.html"><a href="index.html#using-ggplot-to-create-a-scatter-plot"><i class="fa fa-check"></i><b>1.6.1</b> Using <code>ggplot</code> to create a scatter plot</a></li>
<li class="chapter" data-level="1.6.2" data-path="index.html"><a href="index.html#formatting-ggplot-objects"><i class="fa fa-check"></i><b>1.6.2</b> Formatting ggplot objects</a></li>
<li class="chapter" data-level="1.6.3" data-path="index.html"><a href="index.html#changing-the-units"><i class="fa fa-check"></i><b>1.6.3</b> Changing the units</a></li>
<li class="chapter" data-level="1.6.4" data-path="index.html"><a href="index.html#coloring-points-by-group"><i class="fa fa-check"></i><b>1.6.4</b> Coloring points by group</a></li>
<li class="chapter" data-level="1.6.5" data-path="index.html"><a href="index.html#putting-it-all-together"><i class="fa fa-check"></i><b>1.6.5</b> Putting it all together</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reading.html"><a href="reading.html"><i class="fa fa-check"></i><b>2</b> Reading in data locally and from the web</a><ul>
<li class="chapter" data-level="2.1" data-path="reading.html"><a href="reading.html#overview"><i class="fa fa-check"></i><b>2.1</b> Overview</a></li>
<li class="chapter" data-level="2.2" data-path="reading.html"><a href="reading.html#chapter-learning-objectives-1"><i class="fa fa-check"></i><b>2.2</b> Chapter learning objectives</a></li>
<li class="chapter" data-level="2.3" data-path="reading.html"><a href="reading.html#absolute-and-relative-file-paths"><i class="fa fa-check"></i><b>2.3</b> Absolute and relative file paths</a></li>
<li class="chapter" data-level="2.4" data-path="reading.html"><a href="reading.html#reading-tabular-data-from-a-plain-text-file-into-r"><i class="fa fa-check"></i><b>2.4</b> Reading tabular data from a plain text file into R</a><ul>
<li class="chapter" data-level="2.4.1" data-path="reading.html"><a href="reading.html#skipping-rows-when-reading-in-data"><i class="fa fa-check"></i><b>2.4.1</b> Skipping rows when reading in data</a></li>
<li class="chapter" data-level="2.4.2" data-path="reading.html"><a href="reading.html#read_delim-as-a-more-flexible-method-to-get-tabular-data-into-r"><i class="fa fa-check"></i><b>2.4.2</b> <code>read_delim</code> as a more flexible method to get tabular data into R</a></li>
<li class="chapter" data-level="2.4.3" data-path="reading.html"><a href="reading.html#reading-tabular-data-directly-from-a-url"><i class="fa fa-check"></i><b>2.4.3</b> Reading tabular data directly from a URL</a></li>
<li class="chapter" data-level="2.4.4" data-path="reading.html"><a href="reading.html#previewing-a-data-file-before-reading-it-into-r"><i class="fa fa-check"></i><b>2.4.4</b> Previewing a data file before reading it into R</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="reading.html"><a href="reading.html#reading-data-from-an-microsoft-excel-file"><i class="fa fa-check"></i><b>2.5</b> Reading data from an Microsoft Excel file</a></li>
<li class="chapter" data-level="2.6" data-path="reading.html"><a href="reading.html#reading-data-from-a-database"><i class="fa fa-check"></i><b>2.6</b> Reading data from a database</a><ul>
<li class="chapter" data-level="2.6.1" data-path="reading.html"><a href="reading.html#reading-data-from-a-sqlite-database"><i class="fa fa-check"></i><b>2.6.1</b> Reading data from a SQLite database</a></li>
<li class="chapter" data-level="2.6.2" data-path="reading.html"><a href="reading.html#reading-data-from-a-postgresql-database"><i class="fa fa-check"></i><b>2.6.2</b> Reading data from a PostgreSQL database</a></li>
</ul></li>
<li class="chapter" data-level="2.7" data-path="reading.html"><a href="reading.html#writing-data-from-r-to-a-.csv-file"><i class="fa fa-check"></i><b>2.7</b> Writing data from R to a <code>.csv</code> file</a></li>
<li class="chapter" data-level="2.8" data-path="reading.html"><a href="reading.html#scraping-data-off-the-web-using-r"><i class="fa fa-check"></i><b>2.8</b> Scraping data off the web using R</a><ul>
<li class="chapter" data-level="2.8.1" data-path="reading.html"><a href="reading.html#html-and-css-selectors"><i class="fa fa-check"></i><b>2.8.1</b> HTML and CSS selectors</a></li>
<li class="chapter" data-level="2.8.2" data-path="reading.html"><a href="reading.html#are-you-allowed-to-scrape-that-website"><i class="fa fa-check"></i><b>2.8.2</b> Are you allowed to scrape that website?</a></li>
<li class="chapter" data-level="2.8.3" data-path="reading.html"><a href="reading.html#using-rvest"><i class="fa fa-check"></i><b>2.8.3</b> Using <code>rvest</code></a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="reading.html"><a href="reading.html#additional-readingsresources"><i class="fa fa-check"></i><b>2.9</b> Additional readings/resources</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="wrangling.html"><a href="wrangling.html"><i class="fa fa-check"></i><b>3</b> Cleaning and wrangling data</a><ul>
<li class="chapter" data-level="3.1" data-path="wrangling.html"><a href="wrangling.html#overview-1"><i class="fa fa-check"></i><b>3.1</b> Overview</a></li>
<li class="chapter" data-level="3.2" data-path="wrangling.html"><a href="wrangling.html#chapter-learning-objectives-2"><i class="fa fa-check"></i><b>3.2</b> Chapter learning objectives</a></li>
<li class="chapter" data-level="3.3" data-path="wrangling.html"><a href="wrangling.html#vectors-and-data-frames"><i class="fa fa-check"></i><b>3.3</b> Vectors and Data frames</a><ul>
<li class="chapter" data-level="3.3.1" data-path="wrangling.html"><a href="wrangling.html#what-is-a-data-frame"><i class="fa fa-check"></i><b>3.3.1</b> What is a data frame?</a></li>
<li class="chapter" data-level="3.3.2" data-path="wrangling.html"><a href="wrangling.html#what-is-a-vector"><i class="fa fa-check"></i><b>3.3.2</b> What is a vector?</a></li>
<li class="chapter" data-level="3.3.3" data-path="wrangling.html"><a href="wrangling.html#how-are-vectors-different-from-a-list"><i class="fa fa-check"></i><b>3.3.3</b> How are vectors different from a list?</a></li>
<li class="chapter" data-level="3.3.4" data-path="wrangling.html"><a href="wrangling.html#what-does-this-have-to-do-with-data-frames"><i class="fa fa-check"></i><b>3.3.4</b> What does this have to do with data frames?</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="wrangling.html"><a href="wrangling.html#tidy-data"><i class="fa fa-check"></i><b>3.4</b> Tidy Data</a><ul>
<li class="chapter" data-level="3.4.1" data-path="wrangling.html"><a href="wrangling.html#what-is-tidy-data"><i class="fa fa-check"></i><b>3.4.1</b> What is tidy data?</a></li>
<li class="chapter" data-level="3.4.2" data-path="wrangling.html"><a href="wrangling.html#why-is-tidy-data-important-in-r"><i class="fa fa-check"></i><b>3.4.2</b> Why is tidy data important in R?</a></li>
<li class="chapter" data-level="3.4.3" data-path="wrangling.html"><a href="wrangling.html#going-from-wide-to-long-or-tidy-using-gather"><i class="fa fa-check"></i><b>3.4.3</b> Going from wide to long (or tidy!) using <code>gather</code></a></li>
<li class="chapter" data-level="3.4.4" data-path="wrangling.html"><a href="wrangling.html#using-separate-to-deal-with-multiple-delimiters"><i class="fa fa-check"></i><b>3.4.4</b> Using separate to deal with multiple delimiters</a></li>
<li class="chapter" data-level="3.4.5" data-path="wrangling.html"><a href="wrangling.html#notes-on-defining-tidy-data"><i class="fa fa-check"></i><b>3.4.5</b> Notes on defining tidy data</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="wrangling.html"><a href="wrangling.html#combining-functions-using-the-pipe-operator"><i class="fa fa-check"></i><b>3.5</b> Combining functions using the pipe operator, <code>%&gt;%</code>:</a><ul>
<li class="chapter" data-level="3.5.1" data-path="wrangling.html"><a href="wrangling.html#using-to-combine-filter-and-select"><i class="fa fa-check"></i><b>3.5.1</b> Using <code>%&gt;%</code> to combine <code>filter</code> and <code>select</code></a></li>
<li class="chapter" data-level="3.5.2" data-path="wrangling.html"><a href="wrangling.html#using-with-more-than-two-functions"><i class="fa fa-check"></i><b>3.5.2</b> Using <code>%&gt;%</code> with more than two functions</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="wrangling.html"><a href="wrangling.html#iterating-over-data-with-group_by-summarize"><i class="fa fa-check"></i><b>3.6</b> Iterating over data with <code>group_by</code> + <code>summarize</code></a><ul>
<li class="chapter" data-level="3.6.1" data-path="wrangling.html"><a href="wrangling.html#calculating-summary-statistics"><i class="fa fa-check"></i><b>3.6.1</b> Calculating summary statistics:</a></li>
<li class="chapter" data-level="3.6.2" data-path="wrangling.html"><a href="wrangling.html#calculating-group-summary-statistics"><i class="fa fa-check"></i><b>3.6.2</b> Calculating group summary statistics:</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="wrangling.html"><a href="wrangling.html#additional-reading-on-the-dplyr-functions"><i class="fa fa-check"></i><b>3.7</b> Additional reading on the <code>dplyr</code> functions</a></li>
<li class="chapter" data-level="3.8" data-path="wrangling.html"><a href="wrangling.html#using-purrrs-map-functions-to-iterate"><i class="fa fa-check"></i><b>3.8</b> Using <code>purrr</code>’s <code>map*</code> functions to iterate</a><ul>
<li class="chapter" data-level="3.8.1" data-path="wrangling.html"><a href="wrangling.html#a-bit-more-about-the-map_-functions"><i class="fa fa-check"></i><b>3.8.1</b> A bit more about the <code>map_*</code> functions</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="wrangling.html"><a href="wrangling.html#additional-readingsresources-1"><i class="fa fa-check"></i><b>3.9</b> Additional readings/resources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="viz.html"><a href="viz.html"><i class="fa fa-check"></i><b>4</b> Effective data visualization</a><ul>
<li class="chapter" data-level="4.1" data-path="viz.html"><a href="viz.html#overview-2"><i class="fa fa-check"></i><b>4.1</b> Overview</a></li>
<li class="chapter" data-level="4.2" data-path="viz.html"><a href="viz.html#chapter-learning-objectives-3"><i class="fa fa-check"></i><b>4.2</b> Chapter learning objectives</a></li>
<li class="chapter" data-level="4.3" data-path="viz.html"><a href="viz.html#choosing-the-visualization"><i class="fa fa-check"></i><b>4.3</b> Choosing the visualization</a></li>
<li class="chapter" data-level="4.4" data-path="viz.html"><a href="viz.html#refining-the-visualization"><i class="fa fa-check"></i><b>4.4</b> Refining the visualization</a></li>
<li class="chapter" data-level="4.5" data-path="viz.html"><a href="viz.html#creating-visualizations-with-ggplot2"><i class="fa fa-check"></i><b>4.5</b> Creating visualizations with <code>ggplot2</code></a><ul>
<li class="chapter" data-level="4.5.1" data-path="viz.html"><a href="viz.html#the-mauna-loa-co2-data-set"><i class="fa fa-check"></i><b>4.5.1</b> The Mauna Loa CO2 data set</a></li>
<li class="chapter" data-level="4.5.2" data-path="viz.html"><a href="viz.html#the-island-landmass-data-set"><i class="fa fa-check"></i><b>4.5.2</b> The island landmass data set</a></li>
<li class="chapter" data-level="4.5.3" data-path="viz.html"><a href="viz.html#the-old-faithful-eruption-waiting-time-data-set"><i class="fa fa-check"></i><b>4.5.3</b> The Old Faithful eruption / waiting time data set</a></li>
<li class="chapter" data-level="4.5.4" data-path="viz.html"><a href="viz.html#the-michelson-speed-of-light-data-set"><i class="fa fa-check"></i><b>4.5.4</b> The Michelson speed of light data set</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="viz.html"><a href="viz.html#explaining-the-visualization"><i class="fa fa-check"></i><b>4.6</b> Explaining the visualization</a></li>
<li class="chapter" data-level="4.7" data-path="viz.html"><a href="viz.html#saving-the-visualization"><i class="fa fa-check"></i><b>4.7</b> Saving the visualization</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="GitHub.html"><a href="GitHub.html"><i class="fa fa-check"></i><b>5</b> Version control with GitHub</a><ul>
<li class="chapter" data-level="5.1" data-path="GitHub.html"><a href="GitHub.html#overview-3"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="GitHub.html"><a href="GitHub.html#videos-to-learn-about-version-control-with-github-and-git"><i class="fa fa-check"></i><b>5.2</b> Videos to learn about version control with GitHub and Git</a><ul>
<li class="chapter" data-level="5.2.1" data-path="GitHub.html"><a href="GitHub.html#creating-a-github-repository"><i class="fa fa-check"></i><b>5.2.1</b> Creating a GitHub repository</a></li>
<li class="chapter" data-level="5.2.2" data-path="GitHub.html"><a href="GitHub.html#exploring-a-github-repository"><i class="fa fa-check"></i><b>5.2.2</b> Exploring a GitHub repository</a></li>
<li class="chapter" data-level="5.2.3" data-path="GitHub.html"><a href="GitHub.html#directly-editing-files-on-github"><i class="fa fa-check"></i><b>5.2.3</b> Directly editing files on GitHub</a></li>
<li class="chapter" data-level="5.2.4" data-path="GitHub.html"><a href="GitHub.html#logging-changes-and-pushing-them-to-github"><i class="fa fa-check"></i><b>5.2.4</b> Logging changes and pushing them to GitHub</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="GitHub.html"><a href="GitHub.html#git-command-cheatsheet"><i class="fa fa-check"></i><b>5.3</b> Git command cheatsheet</a><ul>
<li class="chapter" data-level="5.3.1" data-path="GitHub.html"><a href="GitHub.html#getting-a-repository-from-github-onto-the-server-for-the-first-time"><i class="fa fa-check"></i><b>5.3.1</b> Getting a repository from GitHub onto the server for the first time</a></li>
<li class="chapter" data-level="5.3.2" data-path="GitHub.html"><a href="GitHub.html#logging-changes"><i class="fa fa-check"></i><b>5.3.2</b> Logging changes</a></li>
<li class="chapter" data-level="5.3.3" data-path="GitHub.html"><a href="GitHub.html#sending-your-changes-back-to-github"><i class="fa fa-check"></i><b>5.3.3</b> Sending your changes back to GitHub</a></li>
<li class="chapter" data-level="5.3.4" data-path="GitHub.html"><a href="GitHub.html#getting-changes"><i class="fa fa-check"></i><b>5.3.4</b> Getting changes</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="GitHub.html"><a href="GitHub.html#terminal-cheatsheet"><i class="fa fa-check"></i><b>5.4</b> Terminal cheatsheet</a><ul>
<li class="chapter" data-level="5.4.1" data-path="GitHub.html"><a href="GitHub.html#see-where-you-are"><i class="fa fa-check"></i><b>5.4.1</b> See where you are:</a></li>
<li class="chapter" data-level="5.4.2" data-path="GitHub.html"><a href="GitHub.html#see-what-is-inside-the-directory-where-you-are"><i class="fa fa-check"></i><b>5.4.2</b> See what is inside the directory where you are:</a></li>
<li class="chapter" data-level="5.4.3" data-path="GitHub.html"><a href="GitHub.html#move-to-a-different-directory"><i class="fa fa-check"></i><b>5.4.3</b> Move to a different directory</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="classification.html"><a href="classification.html"><i class="fa fa-check"></i><b>6</b> Classification I: training &amp; predicting</a><ul>
<li class="chapter" data-level="6.1" data-path="classification.html"><a href="classification.html#overview-4"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="classification.html"><a href="classification.html#chapter-learning-objectives-4"><i class="fa fa-check"></i><b>6.2</b> Chapter learning objectives</a></li>
<li class="chapter" data-level="6.3" data-path="classification.html"><a href="classification.html#the-classification-problem"><i class="fa fa-check"></i><b>6.3</b> The classification problem</a></li>
<li class="chapter" data-level="6.4" data-path="classification.html"><a href="classification.html#exploring-a-labelled-data-set"><i class="fa fa-check"></i><b>6.4</b> Exploring a labelled data set</a></li>
<li class="chapter" data-level="6.5" data-path="classification.html"><a href="classification.html#classification-with-k-nearest-neighbours"><i class="fa fa-check"></i><b>6.5</b> Classification with K-nearest neighbours</a></li>
<li class="chapter" data-level="6.6" data-path="classification.html"><a href="classification.html#k-nearest-neighbours-with-tidymodels"><i class="fa fa-check"></i><b>6.6</b> K-nearest neighbours with <code>tidymodels</code></a></li>
<li class="chapter" data-level="6.7" data-path="classification.html"><a href="classification.html#data-preprocessing-with-tidymodels"><i class="fa fa-check"></i><b>6.7</b> Data preprocessing with <code>tidymodels</code></a><ul>
<li class="chapter" data-level="6.7.1" data-path="classification.html"><a href="classification.html#centering-and-scaling"><i class="fa fa-check"></i><b>6.7.1</b> Centering and scaling</a></li>
<li class="chapter" data-level="6.7.2" data-path="classification.html"><a href="classification.html#balancing"><i class="fa fa-check"></i><b>6.7.2</b> Balancing</a></li>
</ul></li>
<li class="chapter" data-level="6.8" data-path="classification.html"><a href="classification.html#putting-it-together-in-a-workflow"><i class="fa fa-check"></i><b>6.8</b> Putting it together in a <code>workflow</code></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="classification-continued.html"><a href="classification-continued.html"><i class="fa fa-check"></i><b>7</b> Classification II: evaluation &amp; tuning</a><ul>
<li class="chapter" data-level="7.1" data-path="classification-continued.html"><a href="classification-continued.html#overview-5"><i class="fa fa-check"></i><b>7.1</b> Overview</a></li>
<li class="chapter" data-level="7.2" data-path="classification-continued.html"><a href="classification-continued.html#chapter-learning-objectives-5"><i class="fa fa-check"></i><b>7.2</b> Chapter learning objectives</a></li>
<li class="chapter" data-level="7.3" data-path="classification-continued.html"><a href="classification-continued.html#evaluating-accuracy"><i class="fa fa-check"></i><b>7.3</b> Evaluating accuracy</a></li>
<li class="chapter" data-level="7.4" data-path="classification-continued.html"><a href="classification-continued.html#tuning-the-classifier"><i class="fa fa-check"></i><b>7.4</b> Tuning the classifier</a><ul>
<li class="chapter" data-level="7.4.1" data-path="classification-continued.html"><a href="classification-continued.html#cross-validation"><i class="fa fa-check"></i><b>7.4.1</b> Cross-validation</a></li>
<li class="chapter" data-level="7.4.2" data-path="classification-continued.html"><a href="classification-continued.html#parameter-value-selection"><i class="fa fa-check"></i><b>7.4.2</b> Parameter value selection</a></li>
<li class="chapter" data-level="7.4.3" data-path="classification-continued.html"><a href="classification-continued.html#underoverfitting"><i class="fa fa-check"></i><b>7.4.3</b> Under/overfitting</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="classification-continued.html"><a href="classification-continued.html#splitting-data"><i class="fa fa-check"></i><b>7.5</b> Splitting data</a></li>
<li class="chapter" data-level="7.6" data-path="classification-continued.html"><a href="classification-continued.html#summary"><i class="fa fa-check"></i><b>7.6</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="regression1.html"><a href="regression1.html"><i class="fa fa-check"></i><b>8</b> Regression I: K-nearest neighbours</a><ul>
<li class="chapter" data-level="8.1" data-path="regression1.html"><a href="regression1.html#overview-6"><i class="fa fa-check"></i><b>8.1</b> Overview</a></li>
<li class="chapter" data-level="8.2" data-path="regression1.html"><a href="regression1.html#chapter-learning-objectives-6"><i class="fa fa-check"></i><b>8.2</b> Chapter learning objectives</a></li>
<li class="chapter" data-level="8.3" data-path="regression1.html"><a href="regression1.html#regression"><i class="fa fa-check"></i><b>8.3</b> Regression</a></li>
<li class="chapter" data-level="8.4" data-path="regression1.html"><a href="regression1.html#sacremento-real-estate-example"><i class="fa fa-check"></i><b>8.4</b> Sacremento real estate example</a></li>
<li class="chapter" data-level="8.5" data-path="regression1.html"><a href="regression1.html#k-nearest-neighbours-regression"><i class="fa fa-check"></i><b>8.5</b> K-nearest neighbours regression</a></li>
<li class="chapter" data-level="8.6" data-path="regression1.html"><a href="regression1.html#training-evaluating-and-tuning-the-model"><i class="fa fa-check"></i><b>8.6</b> Training, evaluating, and tuning the model</a></li>
<li class="chapter" data-level="8.7" data-path="regression1.html"><a href="regression1.html#underfitting-and-overfitting"><i class="fa fa-check"></i><b>8.7</b> Underfitting and overfitting</a></li>
<li class="chapter" data-level="8.8" data-path="regression1.html"><a href="regression1.html#evaluating-on-the-test-set"><i class="fa fa-check"></i><b>8.8</b> Evaluating on the test set</a></li>
<li class="chapter" data-level="8.9" data-path="regression1.html"><a href="regression1.html#strengths-and-limitations-of-k-nn-regression"><i class="fa fa-check"></i><b>8.9</b> Strengths and limitations of K-NN regression</a></li>
<li class="chapter" data-level="8.10" data-path="regression1.html"><a href="regression1.html#multivariate-k-nn-regression"><i class="fa fa-check"></i><b>8.10</b> Multivariate K-NN regression</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="regression2.html"><a href="regression2.html"><i class="fa fa-check"></i><b>9</b> Regression II: linear regression</a><ul>
<li class="chapter" data-level="9.1" data-path="regression2.html"><a href="regression2.html#overview-7"><i class="fa fa-check"></i><b>9.1</b> Overview</a></li>
<li class="chapter" data-level="9.2" data-path="regression2.html"><a href="regression2.html#chapter-learning-objectives-7"><i class="fa fa-check"></i><b>9.2</b> Chapter learning objectives</a></li>
<li class="chapter" data-level="9.3" data-path="regression2.html"><a href="regression2.html#simple-linear-regression"><i class="fa fa-check"></i><b>9.3</b> Simple linear regression</a></li>
<li class="chapter" data-level="9.4" data-path="regression2.html"><a href="regression2.html#linear-regression-in-r"><i class="fa fa-check"></i><b>9.4</b> Linear regression in R</a></li>
<li class="chapter" data-level="9.5" data-path="regression2.html"><a href="regression2.html#comparing-simple-linear-and-k-nn-regression"><i class="fa fa-check"></i><b>9.5</b> Comparing simple linear and K-NN regression</a></li>
<li class="chapter" data-level="9.6" data-path="regression2.html"><a href="regression2.html#multivariate-linear-regression"><i class="fa fa-check"></i><b>9.6</b> Multivariate linear regression</a></li>
<li class="chapter" data-level="9.7" data-path="regression2.html"><a href="regression2.html#the-other-side-of-regression"><i class="fa fa-check"></i><b>9.7</b> The other side of regression</a></li>
<li class="chapter" data-level="9.8" data-path="regression2.html"><a href="regression2.html#additional-readingsresources-2"><i class="fa fa-check"></i><b>9.8</b> Additional readings/resources</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="clustering.html"><a href="clustering.html"><i class="fa fa-check"></i><b>10</b> Clustering</a><ul>
<li class="chapter" data-level="10.1" data-path="clustering.html"><a href="clustering.html#overview-8"><i class="fa fa-check"></i><b>10.1</b> Overview</a></li>
<li class="chapter" data-level="10.2" data-path="clustering.html"><a href="clustering.html#chapter-learning-objectives-8"><i class="fa fa-check"></i><b>10.2</b> Chapter learning objectives</a></li>
<li class="chapter" data-level="10.3" data-path="clustering.html"><a href="clustering.html#clustering-1"><i class="fa fa-check"></i><b>10.3</b> Clustering</a></li>
<li class="chapter" data-level="10.4" data-path="clustering.html"><a href="clustering.html#k-means"><i class="fa fa-check"></i><b>10.4</b> K-means</a><ul>
<li class="chapter" data-level="10.4.1" data-path="clustering.html"><a href="clustering.html#measuring-cluster-quality"><i class="fa fa-check"></i><b>10.4.1</b> Measuring cluster quality</a></li>
<li class="chapter" data-level="10.4.2" data-path="clustering.html"><a href="clustering.html#the-clustering-algorithm"><i class="fa fa-check"></i><b>10.4.2</b> The clustering algorithm</a></li>
<li class="chapter" data-level="10.4.3" data-path="clustering.html"><a href="clustering.html#random-restarts"><i class="fa fa-check"></i><b>10.4.3</b> Random restarts</a></li>
<li class="chapter" data-level="10.4.4" data-path="clustering.html"><a href="clustering.html#choosing-k"><i class="fa fa-check"></i><b>10.4.4</b> Choosing K</a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="clustering.html"><a href="clustering.html#k-means-in-r"><i class="fa fa-check"></i><b>10.5</b> K-means in R</a></li>
<li class="chapter" data-level="10.6" data-path="clustering.html"><a href="clustering.html#additional-readings"><i class="fa fa-check"></i><b>10.6</b> Additional readings:</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="inference.html"><a href="inference.html"><i class="fa fa-check"></i><b>11</b> Introduction to Statistical Inference</a><ul>
<li class="chapter" data-level="11.1" data-path="inference.html"><a href="inference.html#overview-9"><i class="fa fa-check"></i><b>11.1</b> Overview</a></li>
<li class="chapter" data-level="11.2" data-path="inference.html"><a href="inference.html#chapter-learning-objectives-9"><i class="fa fa-check"></i><b>11.2</b> Chapter learning objectives</a></li>
<li class="chapter" data-level="11.3" data-path="inference.html"><a href="inference.html#why-do-we-need-sampling"><i class="fa fa-check"></i><b>11.3</b> Why do we need sampling?</a></li>
<li class="chapter" data-level="11.4" data-path="inference.html"><a href="inference.html#sampling-distributions"><i class="fa fa-check"></i><b>11.4</b> Sampling distributions</a><ul>
<li class="chapter" data-level="11.4.1" data-path="inference.html"><a href="inference.html#sampling-distributions-for-proportions"><i class="fa fa-check"></i><b>11.4.1</b> Sampling distributions for proportions</a></li>
<li class="chapter" data-level="11.4.2" data-path="inference.html"><a href="inference.html#sampling-distributions-for-means"><i class="fa fa-check"></i><b>11.4.2</b> Sampling distributions for means</a></li>
<li class="chapter" data-level="11.4.3" data-path="inference.html"><a href="inference.html#summary-1"><i class="fa fa-check"></i><b>11.4.3</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="inference.html"><a href="inference.html#bootstrapping"><i class="fa fa-check"></i><b>11.5</b> Bootstrapping</a><ul>
<li class="chapter" data-level="11.5.1" data-path="inference.html"><a href="inference.html#overview-10"><i class="fa fa-check"></i><b>11.5.1</b> Overview</a></li>
<li class="chapter" data-level="11.5.2" data-path="inference.html"><a href="inference.html#bootstrapping-in-r"><i class="fa fa-check"></i><b>11.5.2</b> Bootstrapping in R</a></li>
<li class="chapter" data-level="11.5.3" data-path="inference.html"><a href="inference.html#using-the-bootstrap-to-calculate-a-plausible-range"><i class="fa fa-check"></i><b>11.5.3</b> Using the bootstrap to calculate a plausible range</a></li>
</ul></li>
<li class="chapter" data-level="11.6" data-path="inference.html"><a href="inference.html#additional-readings-1"><i class="fa fa-check"></i><b>11.6</b> Additional readings</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Introduction to Data Science</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="wrangling" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Cleaning and wrangling data</h1>
<div id="overview-1" class="section level2">
<h2><span class="header-section-number">3.1</span> Overview</h2>
<p>This chapter will be centered around tools for cleaning and wrangling data that move data from its raw format into a format that is suitable for data analysis. They
will be presented in the context of a real world data science application, providing more practice working through a whole case study.</p>
</div>
<div id="chapter-learning-objectives-2" class="section level2">
<h2><span class="header-section-number">3.2</span> Chapter learning objectives</h2>
<p>By the end of the chapter, students will be able to:</p>
<ul>
<li>define the term “tidy data”</li>
<li>discuss the advantages and disadvantages from storing data in a tidy data format</li>
<li>recall and use the following tidyverse functions and operators for their intended data wrangling tasks:
<ul>
<li><code>select</code></li>
<li><code>filter</code></li>
<li><code>%&gt;%</code></li>
<li><code>map</code></li>
<li><code>mutate</code></li>
<li><code>summarize</code></li>
<li><code>group_by</code></li>
<li><code>gather</code></li>
<li><code>separate</code></li>
<li><code>%in%</code></li>
</ul></li>
</ul>
</div>
<div id="vectors-and-data-frames" class="section level2">
<h2><span class="header-section-number">3.3</span> Vectors and Data frames</h2>
<p>At this point, we know how to load data into R from various file formats. Once loaded into R, all the tools we have learned about for reading data into R represent
the data as a data frame. So now we will spend some time learning more about data frames in R, such that we have a better understanding
of how we can use and manipulate these objects.</p>
<div id="what-is-a-data-frame" class="section level3">
<h3><span class="header-section-number">3.3.1</span> What is a data frame?</h3>
<p>Let’s first start by defining exactly what a data frame is. From a data perspective, it is a rectangle where the rows are the observations:</p>
<p><img src="img/obs.jpeg" width="650"></p>
<p>and the columns are the variables:</p>
<p><img src="img/vars.jpeg" width="650"></p>
<p>From a computer programming perspective, in R, a data frame is a special subtype of a list object whose elements (columns) are <em>vectors</em>.
For example, the data frame below has 3 elements that are vectors whose names are <code>state</code>, <code>year</code> and <code>population</code>.</p>
<p><img src="img/vectors.jpeg" width="650"></p>
</div>
<div id="what-is-a-vector" class="section level3">
<h3><span class="header-section-number">3.3.2</span> What is a vector?</h3>
<p>In R, vectors are objects that can contain 1 or more elements. The vector elements are ordered, and they must all be of the same type. Common
example types of vectors are character (e.g., letter or words), numeric (whole numbers and fractions) and logical (e.g., <code>TRUE</code> or <code>FALSE</code>). In
the vector shown below, the elements are of numeric type:</p>
<p><img src="img/vector.jpeg" width="600"></p>
</div>
<div id="how-are-vectors-different-from-a-list" class="section level3">
<h3><span class="header-section-number">3.3.3</span> How are vectors different from a list?</h3>
<p>Lists are also objects in R that have multiple elements. Vectors and lists differ by the requirement of element type consistency. All elements
within a single vector must be of the same type (e.g., all elements are numbers), whereas elements within a single list can be of different
types (e.g., characters, numbers, logicals and even other lists can be elements in the same list).</p>
<p><img src="img/vec_vs_list.jpeg" width="600"></p>
</div>
<div id="what-does-this-have-to-do-with-data-frames" class="section level3">
<h3><span class="header-section-number">3.3.4</span> What does this have to do with data frames?</h3>
<p>As mentioned earlier, a data frame is really a special type of list where the elements can only be vectors. Representing data with such an
object enables us to easily work with our data in a rectangular/spreadsheet like manner, and to have columns/vectors of
different characteristics associated/linked in one object. This is similar to a table in a spreadsheet or a database.</p>
<p><img src="img/dataframe.jpeg" width="650"></p>
</div>
</div>
<div id="tidy-data" class="section level2">
<h2><span class="header-section-number">3.4</span> Tidy Data</h2>
<p>There are many ways spreadsheet-like dataset can be organized. In this chapter we are going to focus on the <em>tidy data</em>
format of organization, and how to make your raw (and likely messy) data tidy. This is because a variety of tools we would like to
be able to use in R are designed to work most effectively (and efficiently) with tidy data.</p>
<div id="what-is-tidy-data" class="section level3">
<h3><span class="header-section-number">3.4.1</span> What is tidy data?</h3>
<p>Tidy data satisfy the following three criteria:</p>
<ul>
<li>each row is a single observation,</li>
<li>each column is a single variable, and</li>
<li>each value is a single cell (i.e., its row and column position in the data frame is not shared with another value)</li>
</ul>
<p><img src="img/tidy.png" width="650">
<em>image source: <a href="https://r4ds.had.co.nz/">R for Data Science</a> by Garrett Grolemund &amp; Hadley Wickham</em></p>
<blockquote>
<p><strong>Definitions to know:</strong></p>
<p>observation - all of the quantities or a qualities we collect from a given entity/object</p>
<p>variable - any characteristic, number, or quantity that can be measured or collected</p>
<p>value - a single collected quantity or a quality from a given entity/object</p>
</blockquote>
</div>
<div id="why-is-tidy-data-important-in-r" class="section level3">
<h3><span class="header-section-number">3.4.2</span> Why is tidy data important in R?</h3>
<p>First, one of the most popular plotting toolsets in R, the <code>ggplot2</code> library, expects the data to be in a tidy format. Second, most statistical analysis functions expect data in tidy format. Given that both of these tasks are central in virtually any data analysis
project, it is well worth spending the time to get your data into a tidy format up front. Luckily there are many well designed <code>tidyverse</code> data cleaning/wrangling tools to help you easily tidy your data. Let’s explore them now!</p>
</div>
<div id="going-from-wide-to-long-or-tidy-using-gather" class="section level3">
<h3><span class="header-section-number">3.4.3</span> Going from wide to long (or tidy!) using <code>gather</code></h3>
<p>One common thing that often has to be done to get data into a tidy format is to combine columns that are really part the same variable but currently stored in separate columns. To do this we can use the function <code>gather</code>. <code>gather</code> acts to combine columns, and thus makes the data frame narrower.</p>
<p>Data is often stored in a wider, not tidy, format because this format is often more intuitive for human readability and understanding, and humans create data sets. An example of this is shown below:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="wrangling.html#cb91-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb91-2"><a href="wrangling.html#cb91-2"></a>hist_vote_wide &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/us_vote.csv&quot;</span>) </span>
<span id="cb91-3"><a href="wrangling.html#cb91-3"></a>hist_vote_wide &lt;-<span class="st"> </span><span class="kw">select</span>(hist_vote_wide, election_year, winner, runnerup)</span>
<span id="cb91-4"><a href="wrangling.html#cb91-4"></a>hist_vote_wide &lt;-<span class="st"> </span><span class="kw">tail</span>(hist_vote_wide, <span class="dv">10</span>)</span>
<span id="cb91-5"><a href="wrangling.html#cb91-5"></a>hist_vote_wide</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    election_year winner            runnerup         
##            &lt;dbl&gt; &lt;chr&gt;             &lt;chr&gt;            
##  1          1980 Ronald Reagan     Jimmy Carter     
##  2          1984 Ronald Reagan     Walter Mondale   
##  3          1988 George H. W. Bush Michael Dukakis  
##  4          1992 Bill Clinton      George H. W. Bush
##  5          1996 Bill Clinton      Bob Dole         
##  6          2000 George W. Bush    Al Gore          
##  7          2004 George W. Bush    John Kerry       
##  8          2008 Barack Obama      John McCain      
##  9          2012 Barack Obama      Mitt Romney      
## 10          2016 Donald Trump      Hillary Clinton</code></pre>
<p>What is wrong with our untidy format above? From a data analysis perspective, this format is not ideal because in this format the outcome of the variable “result” (winner or runner up) is stored as column names and not easily accessible for the data analysis functions we will want to apply to our data set. Additionally, the values of the “candidate” variable are spread across two columns and will require some sort of binding or joining to get them into one single column to allow us to do our desired visualization and statistical tasks later on.</p>
<p>To accomplish this data tranformation we will use the <code>tidyverse</code> function <code>gather</code>. To use gather we need to specify:</p>
<ol style="list-style-type: decimal">
<li><p>the dataset</p></li>
<li><p>the key: the name of a new column that will be created, whose values will come from the <em>names of the columns</em> that we want to combine (the <code>result</code> argument)</p></li>
<li><p>the value: the name of a new column that will be created, whose values will come from the <em>values of the columns</em> we want to combine (the <code>value</code> argument)</p></li>
<li><p>the names of the columns that we want to combine (we list these after specifying the key and value, and separate the column names with commas)</p></li>
</ol>
<p>For the above example, we use gather to combine the winner and runnerup columns into a single column called candidate, and create a column called
result that contains the outcome of the election for each candidate:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="wrangling.html#cb93-1"></a>hist_vote_tidy &lt;-<span class="st"> </span><span class="kw">gather</span>(hist_vote_wide, </span>
<span id="cb93-2"><a href="wrangling.html#cb93-2"></a>                         <span class="dt">key =</span> result, </span>
<span id="cb93-3"><a href="wrangling.html#cb93-3"></a>                         <span class="dt">value =</span> candidate, </span>
<span id="cb93-4"><a href="wrangling.html#cb93-4"></a>                         winner, runnerup)</span>
<span id="cb93-5"><a href="wrangling.html#cb93-5"></a>hist_vote_tidy</span></code></pre></div>
<pre><code>## # A tibble: 20 x 3
##    election_year result   candidate        
##            &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;            
##  1          1980 winner   Ronald Reagan    
##  2          1984 winner   Ronald Reagan    
##  3          1988 winner   George H. W. Bush
##  4          1992 winner   Bill Clinton     
##  5          1996 winner   Bill Clinton     
##  6          2000 winner   George W. Bush   
##  7          2004 winner   George W. Bush   
##  8          2008 winner   Barack Obama     
##  9          2012 winner   Barack Obama     
## 10          2016 winner   Donald Trump     
## 11          1980 runnerup Jimmy Carter     
## 12          1984 runnerup Walter Mondale   
## 13          1988 runnerup Michael Dukakis  
## 14          1992 runnerup George H. W. Bush
## 15          1996 runnerup Bob Dole         
## 16          2000 runnerup Al Gore          
## 17          2004 runnerup John Kerry       
## 18          2008 runnerup John McCain      
## 19          2012 runnerup Mitt Romney      
## 20          2016 runnerup Hillary Clinton</code></pre>
<blockquote>
<p><strong>Splitting code across lines</strong>: In the code above, the call to the <code>gather</code> function is split across several lines.<em>
</em>This is allowed and encouraged when programming in R when your code line gets too long<em>
</em>to read clearly. When doing this, it is important to end the line with a comma <code>,</code> so that R<em>
</em>knows the function should continue to the next line.*</p>
</blockquote>
<p>The data above is now tidy because all 3 criteria for tidy data have now been met:</p>
<ol style="list-style-type: decimal">
<li>All the variables (<code>candidate</code> and <code>result</code>) are now their own columns in the data frame.</li>
<li>Each observation, i.e., each candidate’s name, result, and candidacy year, are in a single row.</li>
<li>Each value is a single cell, i.e., its row, column position in the data frame is not shared with another value.</li>
</ol>
</div>
<div id="using-separate-to-deal-with-multiple-delimiters" class="section level3">
<h3><span class="header-section-number">3.4.4</span> Using separate to deal with multiple delimiters</h3>
<p>As discussed above, data are also not considered tidy when multiple values are stored in the same cell. In addition to the
previous untidiness we addressed in the earlier version of this data set, the one we show below is even messier:
the winner and runnerup columns contain both the candidate’s name as well as their political party. To make this
messy data tidy we’ll have to fix both of these issues.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="wrangling.html#cb95-1"></a>hist_vote_party &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/historical_vote_messy.csv&quot;</span>)</span>
<span id="cb95-2"><a href="wrangling.html#cb95-2"></a>hist_vote_party</span></code></pre></div>
<pre><code>## # A tibble: 10 x 3
##    election_year winner             runnerup           
##            &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;              
##  1          2016 Donald Trump/Rep   Hillary Clinton/Dem
##  2          2012 Barack Obama/Dem   Mitt Romney/Rep    
##  3          2008 Barack Obama/Dem   John McCain/Rep    
##  4          2004 George W Bush/Rep  John Kerry/Dem     
##  5          2000 George W Bush/Rep  Al Gore/Dem        
##  6          1996 Bill Clinton/Dem   Bob Dole/Rep       
##  7          1992 Bill Clinton/Dem   George HW Bush/Rep 
##  8          1988 George HW Bush/Rep Michael Dukakis/Dem
##  9          1984 Ronald Reagan/Rep  Walter Mondale/Dem 
## 10          1980 Ronald Reagan/Rep  Jimmy Carter/Dem</code></pre>
<p>First we’ll use <code>gather</code> to create the result and candidate columns, as we did previously:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="wrangling.html#cb97-1"></a>hist_vote_party_gathered &lt;-<span class="st"> </span><span class="kw">gather</span>(hist_vote_party, </span>
<span id="cb97-2"><a href="wrangling.html#cb97-2"></a>                          <span class="dt">key =</span> result, </span>
<span id="cb97-3"><a href="wrangling.html#cb97-3"></a>                          <span class="dt">value =</span> candidate, </span>
<span id="cb97-4"><a href="wrangling.html#cb97-4"></a>                          winner, runnerup)</span>
<span id="cb97-5"><a href="wrangling.html#cb97-5"></a>hist_vote_party_gathered</span></code></pre></div>
<pre><code>## # A tibble: 20 x 3
##    election_year result   candidate          
##            &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;              
##  1          2016 winner   Donald Trump/Rep   
##  2          2012 winner   Barack Obama/Dem   
##  3          2008 winner   Barack Obama/Dem   
##  4          2004 winner   George W Bush/Rep  
##  5          2000 winner   George W Bush/Rep  
##  6          1996 winner   Bill Clinton/Dem   
##  7          1992 winner   Bill Clinton/Dem   
##  8          1988 winner   George HW Bush/Rep 
##  9          1984 winner   Ronald Reagan/Rep  
## 10          1980 winner   Ronald Reagan/Rep  
## 11          2016 runnerup Hillary Clinton/Dem
## 12          2012 runnerup Mitt Romney/Rep    
## 13          2008 runnerup John McCain/Rep    
## 14          2004 runnerup John Kerry/Dem     
## 15          2000 runnerup Al Gore/Dem        
## 16          1996 runnerup Bob Dole/Rep       
## 17          1992 runnerup George HW Bush/Rep 
## 18          1988 runnerup Michael Dukakis/Dem
## 19          1984 runnerup Walter Mondale/Dem 
## 20          1980 runnerup Jimmy Carter/Dem</code></pre>
<p>Then we’ll use <code>separate</code> to split the candidate column into two columns, one that
contains only the candidate’s name (“candidate”), and one that contains a short identifier for which
political party the candidate belonged to (“party”):</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="wrangling.html#cb99-1"></a>hist_vote_party_tidy &lt;-<span class="st"> </span><span class="kw">separate</span>(hist_vote_party_gathered,</span>
<span id="cb99-2"><a href="wrangling.html#cb99-2"></a>                                 <span class="dt">col =</span> candidate, </span>
<span id="cb99-3"><a href="wrangling.html#cb99-3"></a>                                 <span class="dt">into =</span> <span class="kw">c</span>(<span class="st">&quot;candidate&quot;</span>, <span class="st">&quot;party&quot;</span>), </span>
<span id="cb99-4"><a href="wrangling.html#cb99-4"></a>                                 <span class="dt">sep =</span> <span class="st">&quot;/&quot;</span>) </span>
<span id="cb99-5"><a href="wrangling.html#cb99-5"></a>hist_vote_party_tidy</span></code></pre></div>
<pre><code>## # A tibble: 20 x 4
##    election_year result   candidate       party
##            &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;           &lt;chr&gt;
##  1          2016 winner   Donald Trump    Rep  
##  2          2012 winner   Barack Obama    Dem  
##  3          2008 winner   Barack Obama    Dem  
##  4          2004 winner   George W Bush   Rep  
##  5          2000 winner   George W Bush   Rep  
##  6          1996 winner   Bill Clinton    Dem  
##  7          1992 winner   Bill Clinton    Dem  
##  8          1988 winner   George HW Bush  Rep  
##  9          1984 winner   Ronald Reagan   Rep  
## 10          1980 winner   Ronald Reagan   Rep  
## 11          2016 runnerup Hillary Clinton Dem  
## 12          2012 runnerup Mitt Romney     Rep  
## 13          2008 runnerup John McCain     Rep  
## 14          2004 runnerup John Kerry      Dem  
## 15          2000 runnerup Al Gore         Dem  
## 16          1996 runnerup Bob Dole        Rep  
## 17          1992 runnerup George HW Bush  Rep  
## 18          1988 runnerup Michael Dukakis Dem  
## 19          1984 runnerup Walter Mondale  Dem  
## 20          1980 runnerup Jimmy Carter    Dem</code></pre>
<p>Is this data now tidy? Well, if we recall the 3 criteria for tidy data:</p>
<ul>
<li>each row is a single observation,</li>
<li>each column is a single variable, and</li>
<li>each value is a single cell.</li>
</ul>
<p>We can see that this data now satifies all 3 criteria, making it easier to analyze.
For example, we could visualize the number of winning candidates for each party over this time span:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="wrangling.html#cb101-1"></a><span class="kw">ggplot</span>(hist_vote_party_tidy, <span class="kw">aes</span>(<span class="dt">x =</span> result, <span class="dt">fill =</span> party)) <span class="op">+</span></span>
<span id="cb101-2"><a href="wrangling.html#cb101-2"></a><span class="st">  </span><span class="kw">geom_bar</span>() <span class="op">+</span></span>
<span id="cb101-3"><a href="wrangling.html#cb101-3"></a><span class="st">  </span><span class="kw">scale_fill_manual</span>(<span class="dt">values=</span><span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="op">+</span></span>
<span id="cb101-4"><a href="wrangling.html#cb101-4"></a><span class="st">  </span><span class="kw">xlab</span>(<span class="st">&quot;US Presidential election result&quot;</span>) <span class="op">+</span></span>
<span id="cb101-5"><a href="wrangling.html#cb101-5"></a><span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;Number of US Presidential candidates&quot;</span>) <span class="op">+</span></span>
<span id="cb101-6"><a href="wrangling.html#cb101-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;US Presidential candidates (1980 - 2016)&quot;</span>) </span></code></pre></div>
<p><img src="_main_files/figure-html/02-candidate-count-1.png" width="384" /></p>
<p>From this visualization, we can see that between 1980 - 2016 (inclusive) the Republican party has
won more US Presidential elections than the Democratic party.</p>
</div>
<div id="notes-on-defining-tidy-data" class="section level3">
<h3><span class="header-section-number">3.4.5</span> Notes on defining tidy data</h3>
<p>Is there only one shape for tidy data for a given data set? Not necessarily, it depends on the statistical question you are asking and what the variables are for that question. For tidy data, each variable should be its own column. So just as its important to match your statistical question with the appropriate data analysis tool (classification, clustering, hypothesis testing, etc). It’s important to match your statistical question with the appropriate variables and ensure they are each represented as individual columns to make the data tidy.</p>
</div>
</div>
<div id="combining-functions-using-the-pipe-operator" class="section level2">
<h2><span class="header-section-number">3.5</span> Combining functions using the pipe operator, <code>%&gt;%</code>:</h2>
<p>In R, we often have to call multiple functions in a sequence to process a data frame. The basic ways of doing this
can become quickly unreadable if there are many steps. For example, suppose we need to perform three operations on
a data frame <code>data</code>:</p>
<ol style="list-style-type: decimal">
<li>add a new column <code>new_col</code> that is double another <code>old_col</code></li>
<li>filter for rows where another column, <code>other_col</code>, is more than 5, and</li>
<li>select only the new column <code>new_col</code> for those rows.</li>
</ol>
<p>One way of doing is to just write multiple lines of code, storing temporary objects as you go:</p>
<pre><code>output_1 &lt;- mutate(data, new_col = old_col*2)
output_2 &lt;- filter(output_1, other_col &gt; 5)
output &lt;- select(output_2, new_col)</code></pre>
<p>This is difficult to understand for multiple reasons. The reader may be tricked into thinking the named <code>output_1</code> and <code>output_2</code>
objects are important for some reason, while they are just temporary intermediate computations. Further, the reader has to look
through and find where <code>output_1</code> and <code>output_2</code> are used in each subsequent line.</p>
<p>Another option for doing this would be to <em>compose</em> the functions:</p>
<pre><code>output &lt;- select(filter(mutate(data, new_col = old_col*2), other_col &gt; 5), new_col)</code></pre>
<p>Code like this can also be difficult to understand. Functions compose (reading from left to right) in the <em>opposite order</em> in which
they are computed by R (above, <code>mutate</code> happens first, then <code>filter</code>, then <code>select</code>). It is also just a really long line of code
to read in one go.</p>
<p>The <em>pipe operator</em> <code>%&gt;%</code> solves this problem, resulting in cleaner and easier-to-follow code. The below accomplishes the same thing as the previous two code blocks:</p>
<pre><code>output &lt;- data %&gt;% 
            mutate(new_col = old_col*2) %&gt;%
            filter(other_col &gt; 5) %&gt;%
            select(new_col)</code></pre>
<p>You can think of the pipe as a physical pipe. It takes the output from the function on the left-hand side of the pipe, and
passes it as the first argument to the function on the right-hand side of the pipe. Note here that we have again split the
code across multiple lines for readability; R is fine with this, since it knows that a line ending in a pipe <code>%&gt;%</code> is continued
on the next line.</p>
<p>Next, let’s learn about the details of using the pipe, and look at some examples of how to use it in data analysis.</p>
<div id="using-to-combine-filter-and-select" class="section level3">
<h3><span class="header-section-number">3.5.1</span> Using <code>%&gt;%</code> to combine <code>filter</code> and <code>select</code></h3>
<p>Recall the US state-level property, income, population, and voting data that we explored in chapter 1:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="wrangling.html#cb105-1"></a>us_data &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data/state_property_vote.csv&quot;</span>)</span>
<span id="cb105-2"><a href="wrangling.html#cb105-2"></a>us_data</span></code></pre></div>
<pre><code>## # A tibble: 52 x 6
##    state                     pop med_prop_val med_income avg_commute party     
##    &lt;chr&gt;                   &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;     
##  1 Montana               1042520       217200      46608        16.4 Republican
##  2 Alabama               4863300       136200      42917        23.8 Republican
##  3 Arizona               6931071       205900      50036        23.7 Republican
##  4 Arkansas              2988248       123300      41335        20.5 Republican
##  5 California           39250017       477500      61927        27.7 Democratic
##  6 Colorado              5540545       314200      61324        23.0 Democratic
##  7 Connecticut           3576452       274600      70007        24.9 Democratic
##  8 Delaware               952065       243400      59853        25.0 Democratic
##  9 District of Columbia   681170       576100      75506        29.0 Democratic
## 10 Florida              20612439       197700      47439        25.8 Republican
## # … with 42 more rows</code></pre>
<p>Suppose we want to create a subset of the data with only the values for median income and median property value for the state of
California. To do this, we can use the functions <code>filter</code> and <code>select</code>. First we use <code>filter</code> to create a data frame called <code>ca_prop_data</code> that
contains only values for the state of California. We then use <code>select</code> on this data frame to keep only the median income and
median property value variables:</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="wrangling.html#cb107-1"></a>ca_prop_data &lt;-<span class="st"> </span><span class="kw">filter</span>(us_data, state <span class="op">==</span><span class="st"> &quot;California&quot;</span>)</span>
<span id="cb107-2"><a href="wrangling.html#cb107-2"></a>ca_inc_prop &lt;-<span class="st"> </span><span class="kw">select</span>(ca_prop_data, med_income, med_prop_val)</span>
<span id="cb107-3"><a href="wrangling.html#cb107-3"></a>ca_inc_prop</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   med_income med_prop_val
##        &lt;dbl&gt;        &lt;dbl&gt;
## 1      61927       477500</code></pre>
<p>Although this is valid code, there is a more readable approach we could take by using the pipe, <code>%&gt;%</code>. With the pipe,
we do not need to create an intermediate object to store the output from <code>filter</code>. Instead we can directly send the
output of <code>filter</code> to the input of <code>select</code>:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="wrangling.html#cb109-1"></a>ca_inc_prop &lt;-<span class="st"> </span><span class="kw">filter</span>(us_data, state <span class="op">==</span><span class="st"> &quot;California&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb109-2"><a href="wrangling.html#cb109-2"></a><span class="st">                    </span><span class="kw">select</span>(med_income, med_prop_val)</span>
<span id="cb109-3"><a href="wrangling.html#cb109-3"></a>ca_inc_prop</span></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   med_income med_prop_val
##        &lt;dbl&gt;        &lt;dbl&gt;
## 1      61927       477500</code></pre>
<p>But wait - why does our <code>select</code> function call look different in these two examples? When you use the pipe,
the output of the function on the left is automatically provided as the first argument for the function
on the right, and thus you do not specify that argument in that function call. In the code above, the first
argument of <code>select</code> is the data frame we are <code>select</code>-ing from, which is provided by the output of <code>filter</code>.</p>
<p>As you can see, both of these approaches give us the same output but the second approach is more clear and readable.</p>
</div>
<div id="using-with-more-than-two-functions" class="section level3">
<h3><span class="header-section-number">3.5.2</span> Using <code>%&gt;%</code> with more than two functions</h3>
<p>The <code>%&gt;%</code> can be used with any function in R. Additionally, we can pipe together more than two functions. For
example, we can pipe together three functions to order the states by commute time for states whose population
is less than 1 million people:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="wrangling.html#cb111-1"></a>small_state_commutes &lt;-<span class="st"> </span><span class="kw">filter</span>(us_data, pop <span class="op">&lt;</span><span class="st"> </span><span class="dv">1000000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb111-2"><a href="wrangling.html#cb111-2"></a><span class="st">  </span><span class="kw">select</span>(state, avg_commute) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb111-3"><a href="wrangling.html#cb111-3"></a><span class="st">  </span><span class="kw">arrange</span>(avg_commute)</span>
<span id="cb111-4"><a href="wrangling.html#cb111-4"></a>small_state_commutes</span></code></pre></div>
<pre><code>## # A tibble: 7 x 2
##   state                avg_commute
##   &lt;chr&gt;                      &lt;dbl&gt;
## 1 South Dakota                15.7
## 2 Wyoming                     15.9
## 3 North Dakota                16.5
## 4 Alaska                      17.0
## 5 Vermont                     21.5
## 6 Delaware                    25.0
## 7 District of Columbia        29.0</code></pre>
<blockquote>
<p><strong>Note:</strong>: <code>arrange</code> is a function that takes the name of a data frame and one or more column(s), and returns a
data frame where the rows are ordered by those columns in ascending order. Here we used only one column for sorting
(<code>avg_commute</code>), but more than one can also be used. To do this, list additional columns separated by commas.
The order they are listed in indicates the order in which they will be used for sorting. This is much like how an English
dictionary sorts words: first by the first letter, then by the second letter, and so on.</p>
<p><strong>Another Note:</strong> You might also have noticed that we split the function calls across lines after the pipe, similar as to
when we did this earlier in the chapter for long function calls. Again this is allowed and recommeded, especially when the
piped function calls would create a long line of code. Doing this makes your code more readable. When you do this it is important
to end each line with the pipe operator <code>%&gt;%</code> to tell R that your code is continuing onto the next line.</p>
</blockquote>
</div>
</div>
<div id="iterating-over-data-with-group_by-summarize" class="section level2">
<h2><span class="header-section-number">3.6</span> Iterating over data with <code>group_by</code> + <code>summarize</code></h2>
<div id="calculating-summary-statistics" class="section level3">
<h3><span class="header-section-number">3.6.1</span> Calculating summary statistics:</h3>
<p>As a part of many data analyses, we need to calculate a summary value for the data (a summary statistic). A useful <code>dplyr</code> function for doing this is
<code>summarize</code>. Examples of summary statistics we might want to calculate are the number of observations, the average/mean value
for a column, the minimum value for a column, etc. Below we show how to use the summarize function to calculate the minimum, maximum
and mean commute time for all US states:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="wrangling.html#cb113-1"></a>us_commute_time_summary &lt;-<span class="st"> </span><span class="kw">summarize</span>(us_data, </span>
<span id="cb113-2"><a href="wrangling.html#cb113-2"></a>                                  <span class="dt">min_mean_commute =</span> <span class="kw">min</span>(avg_commute),</span>
<span id="cb113-3"><a href="wrangling.html#cb113-3"></a>                                  <span class="dt">max_mean_commute =</span> <span class="kw">max</span>(avg_commute),</span>
<span id="cb113-4"><a href="wrangling.html#cb113-4"></a>                                  <span class="dt">mean_mean_commute =</span> <span class="kw">mean</span>(avg_commute))</span>
<span id="cb113-5"><a href="wrangling.html#cb113-5"></a>us_commute_time_summary</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   min_mean_commute max_mean_commute mean_mean_commute
##              &lt;dbl&gt;            &lt;dbl&gt;             &lt;dbl&gt;
## 1             15.7             32.0              23.3</code></pre>
</div>
<div id="calculating-group-summary-statistics" class="section level3">
<h3><span class="header-section-number">3.6.2</span> Calculating group summary statistics:</h3>
<p>A common pairing with <code>summarize</code> is <code>group_by</code>. Pairing these functions together can let you summarize values for subgroups within a data set. For
example, here we can use <code>group_by</code> to group the states based on which party they voted for in the US election, and then calculate
the minimum, maximum and mean commute time for each of the groups.</p>
<p>The <code>group_by</code> function takes at least two arguments. The first is the data frame that will be grouped, and the second and onwards are columns
to use in the grouping. Here we use only one column for grouping (<code>party</code>), but more than one can also be used. To do this, list additional
columns separated by commas.</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="wrangling.html#cb115-1"></a>us_commute_time_summary_by_party &lt;-<span class="st"> </span><span class="kw">group_by</span>(us_data, party) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb115-2"><a href="wrangling.html#cb115-2"></a><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">min_mean_commute =</span> <span class="kw">min</span>(avg_commute),</span>
<span id="cb115-3"><a href="wrangling.html#cb115-3"></a>            <span class="dt">max_mean_commute =</span> <span class="kw">max</span>(avg_commute),</span>
<span id="cb115-4"><a href="wrangling.html#cb115-4"></a>            <span class="dt">mean_mean_commute =</span> <span class="kw">mean</span>(avg_commute))</span></code></pre></div>
<pre><code>## `summarise()` ungrouping output (override with `.groups` argument)</code></pre>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="wrangling.html#cb117-1"></a>us_commute_time_summary_by_party</span></code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   party          min_mean_commute max_mean_commute mean_mean_commute
##   &lt;chr&gt;                     &lt;dbl&gt;            &lt;dbl&gt;             &lt;dbl&gt;
## 1 Democratic                 20.8             32.0              25.7
## 2 Not Applicable             28.4             28.4              28.4
## 3 Republican                 15.7             26.9              21.5</code></pre>
</div>
</div>
<div id="additional-reading-on-the-dplyr-functions" class="section level2">
<h2><span class="header-section-number">3.7</span> Additional reading on the <code>dplyr</code> functions</h2>
<p>We haven’t explicitly said this yet, but the <code>tidyverse</code> is actually a <em>meta R package</em>: it installs a collection of R packages that all follow
the tidy data philosophy we discussed above. One of the tidyverse packages is <code>dplyr</code> - a data wrangling workhorse. You have already met 6 of
the dplyr function (<code>select</code>, <code>filter</code>, <code>mutate</code>, <code>arrange</code>, <code>summarize</code>, and <code>group_by</code>). To learn more about those six and meet a few more
useful functions, read the post <a href="http://stat545.com/block010_dplyr-end-single-table.html#where-were-we">at this link</a>.</p>
</div>
<div id="using-purrrs-map-functions-to-iterate" class="section level2">
<h2><span class="header-section-number">3.8</span> Using <code>purrr</code>’s <code>map*</code> functions to iterate</h2>
<p>Where should you turn when you discover the next step in your data wrangling/cleaning process requires you to apply a function to
each column in a data frame? For example, if you wanted to know the maximum value of each column in a data frame? Well you could use <code>summarize</code>
as discussed above, but this becomes inconvenient when you have many columns, as <code>summarize</code> requires you to type out a column name and a data
tranformation for each summary statistic that you want to calculate.</p>
<p>In cases like this, where you want to apply the same data transformation to all columns, it is more efficient to use <code>purrr</code>’s <code>map</code> function to
apply it to each column. For example, let’s find the maximum value of each column of the <code>mtcars</code> data frame (a built-in
data set that comes with R) by using <code>map</code> with the <code>max</code> function. First, let’s peak at the data to familiarize ourselves with it:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="wrangling.html#cb119-1"></a><span class="kw">head</span>(mtcars)</span></code></pre></div>
<pre><code>##                    mpg cyl disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
## Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
<p>Next, we use <code>map</code> to apply the <code>max</code> function to each column. <code>map</code> takes two arguments, an object (a vector, data frame or list) that you want
to apply the function to, and the function that you would like to apply. Here our arguments will be <code>mtcars</code> and <code>max</code>:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="wrangling.html#cb121-1"></a>max_of_columns &lt;-<span class="st"> </span><span class="kw">map</span>(mtcars, max)</span>
<span id="cb121-2"><a href="wrangling.html#cb121-2"></a>max_of_columns</span></code></pre></div>
<pre><code>## $mpg
## [1] 33.9
## 
## $cyl
## [1] 8
## 
## $disp
## [1] 472
## 
## $hp
## [1] 335
## 
## $drat
## [1] 4.93
## 
## $wt
## [1] 5.424
## 
## $qsec
## [1] 22.9
## 
## $vs
## [1] 1
## 
## $am
## [1] 1
## 
## $gear
## [1] 5
## 
## $carb
## [1] 8</code></pre>
<blockquote>
<p><strong>Note:</strong> <code>purrr</code> is part of the tidyverse, and so like the <code>dplyr</code> and <code>ggplot</code> functions, once we call <code>library(tidyverse)</code> we
do not need to separately load the <code>purrr</code> package.</p>
</blockquote>
<p>Our output looks a bit weird…we passed in a data frame, but our output doesn’t look like a data frame. As it so happens, it is <em>not</em> a
data frame, but rather a plain vanilla list:</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="wrangling.html#cb123-1"></a><span class="kw">typeof</span>(max_of_columns)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<p>So what do we do? Should we convert this to a data frame? We could, but a simpler alternative is to just use a different <code>map_*</code> function from
the <code>purrr</code> package. There are quite a few to choose from, they all work similarly and their name refects the type of output you want from
the mapping operation:</p>
<table>
<thead>
<tr class="header">
<th><code>map</code> function</th>
<th>Output</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>map()</code></td>
<td>list</td>
</tr>
<tr class="even">
<td><code>map_lgl()</code></td>
<td>logical vector</td>
</tr>
<tr class="odd">
<td><code>map_int()</code></td>
<td>integer vector</td>
</tr>
<tr class="even">
<td><code>map_dbl()</code></td>
<td>double vector</td>
</tr>
<tr class="odd">
<td><code>map_chr()</code></td>
<td>character vector</td>
</tr>
<tr class="even">
<td><code>map_df()</code></td>
<td>data frame</td>
</tr>
</tbody>
</table>
<p>Let’s get the column maximum’s again, but this time use the <code>map_df</code> function to return the output as a data frame:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="wrangling.html#cb125-1"></a>max_of_columns &lt;-<span class="st"> </span><span class="kw">map_df</span>(mtcars, max)</span>
<span id="cb125-2"><a href="wrangling.html#cb125-2"></a>max_of_columns</span></code></pre></div>
<pre><code>## # A tibble: 1 x 11
##     mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  33.9     8   472   335  4.93  5.42  22.9     1     1     5     8</code></pre>
<p>Which <code>map_*</code> function you choose depends on what you want to do with the output; you don’t always have to pick <code>map_df</code>!</p>
<p>What if you need to add other arguments to the functions you want to map? For example, what if there were NA values in our columns that we wanted to know the maximum of? Well then we also need to add the argument <code>na.rm  = TRUE</code> to the <code>max</code> function so that we get a more useful value than NA returned (remember that is what happens with many of the built-in R statistical functions when NA’s are present…). What we need to do in that case is do what is called “creating an anonymous function” within the <code>map_df</code> function. We do that in the place where we previously specified our max function. Here we will put the two calls to <code>map_df</code> right after each other so you can see the difference:</p>
<pre><code># no additional arguments to the max function 
map_df(mtcars, max)</code></pre>
<p>versus</p>
<pre><code># adding the na.rm  = TRUE argument to the max function
map_df(mtcars, function(df) max(df, na.rm  = TRUE))</code></pre>
<p>You can see that’s quite a bit of extra typing… So the creators of <code>purrr</code> have made a shortcut for this because it is so commonly done. In the shortcut we replace <code>function(VARIABLE)</code> with a <code>~</code> and replace the <code>VARIABLE</code> in the function call with a <code>.</code>, see the example below:</p>
<pre><code># adding the na.rm  = TRUE argument to the max function using the shortcut 
map_df(mtcars, ~ max(., na.rm  = TRUE))</code></pre>
<div id="a-bit-more-about-the-map_-functions" class="section level3">
<h3><span class="header-section-number">3.8.1</span> A bit more about the <code>map_*</code> functions</h3>
<p>The <code>map_*</code> functions are generally quite useful for solving problems involving iteration/repetition. Additionally, their use is not limited to columns
of a data frame; <code>map_*</code> functions can be used to apply functions to elements of a vector or list, and even to lists of data frames, or nested data frames.</p>
</div>
</div>
<div id="additional-readingsresources-1" class="section level2">
<h2><span class="header-section-number">3.9</span> Additional readings/resources</h2>
<p>Grolemund &amp; Wickham’s <a href="https://r4ds.had.co.nz/">R for Data Science</a> has a number of useful sections that provide additional information:</p>
<ul>
<li><a href="https://r4ds.had.co.nz/transform.html">Data transformation</a></li>
<li><a href="https://r4ds.had.co.nz/tidy-data.html">Tidy data</a></li>
<li><a href="https://r4ds.had.co.nz/iteration.html#the-map-functions">The <code>map_*</code> functions</a></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="reading.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="viz.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/02-wrangling.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
